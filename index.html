<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UrbanBrief – Planning Reality Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --ub-primary: #1f4f7b;
      --ub-secondary: #f5f7fb;
      --ub-border: #dde2ed;
      --ub-text: #111827;
      --ub-muted: #6b7280;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--ub-secondary);
      color: var(--ub-text);
      line-height: 1.5;
    }

    a { color: var(--ub-primary); }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    header.main-header {
      margin-bottom: 16px;
      padding: 4px 0;
      border-bottom: 1px solid var(--ub-border);
    }

    header.main-header h1 {
      margin: 0;
      font-size: 1.2rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--ub-primary);
    }

    header.main-header p {
      margin: 2px 0 0;
      font-size: 0.85rem;
      color: var(--ub-muted);
    }

    .panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      padding: 24px 20px 28px;
      margin-bottom: 24px;
      border: 1px solid var(--ub-border);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 12px;
    }

    .panel-header h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .panel-header p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--ub-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(31, 79, 123, 0.05);
      color: var(--ub-primary);
    }

    .badge span {
      font-weight: 600;
      font-size: 0.8rem;
    }

    form { display: grid; gap: 18px; }

    .section {
      border-radius: 12px;
      border: 1px solid var(--ub-border);
      padding: 14px 14px 8px;
      background: #ffffff;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
      border-left: 4px solid var(--ub-primary);
      padding-left: 10px;
    }

    .section-header h3 {
      margin: 0;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--ub-primary);
    }

    .section-header span {
      font-size: 0.8rem;
      color: var(--ub-muted);
    }

    .field-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px 16px;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #374151;
    }

    .field small {
      font-size: 0.75rem;
      color: var(--ub-muted);
    }

    input[type="text"],
    input[type="email"],
    input[type="url"],
    select,
    textarea {
      border-radius: 8px;
      border: 1px solid var(--ub-border);
      padding: 7px 9px;
      font-size: 0.9rem;
      font-family: inherit;
      background: #f9fafb;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--ub-primary);
      box-shadow: 0 0 0 2px rgba(31, 79, 123, 0.15);
      background: white;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .inline-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      font-size: 0.85rem;
    }

    .inline-options label {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      font-weight: 500;
      color: #374151;
    }

    .inline-options input[type="checkbox"],
    .inline-options input[type="radio"] {
      accent-color: var(--ub-primary);
    }

    .subsection-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: #111827;
      margin: 4px 0 2px;
    }

    .divider {
      border-top: 1px dashed var(--ub-border);
      margin: 8px 0 6px;
    }

    .hint {
      font-size: 0.8rem;
      color: var(--ub-muted);
      margin-top: 2px;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
    }

    button.primary {
      background: var(--ub-primary);
      color: white;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.25);
    }

    button.secondary {
      background: white;
      color: var(--ub-primary);
      border: 1px solid var(--ub-border);
    }

    button:hover { transform: translateY(-1px); }
    button:active { transform: translateY(0); box-shadow: none; }

    .note {
      font-size: 0.8rem;
      color: var(--ub-muted);
      margin-top: 6px;
    }

    /* REPORT STYLES */

    #report-panel { display: none; }

    #report {
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 30px 36px;
      background: #ffffff;
      border-radius: 16px;
      border: 1px solid var(--ub-border);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
    }

    .report-header {
      border-radius: 14px;
      border: 1px solid var(--ub-border);
      background: linear-gradient(120deg, #ffffff, #eef3fb);
      padding: 14px 16px 12px;
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.2fr) auto;
      gap: 12px;
      margin-bottom: 14px;
      border-top: 5px solid var(--ub-primary);
    }

    .report-title-block h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--ub-primary);
    }

    .report-title-block p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--ub-muted);
    }

    .report-meta {
      text-align: right;
      font-size: 0.8rem;
      color: var(--ub-muted);
    }

    .report-meta div { margin-bottom: 2px; }

    .report-logo-box {
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .report-logo-img {
  max-height: 110px;  /* make it more prominent */
  height: auto;
  width: auto;
}

    .report-section {
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
    }

    .report-section:last-of-type {
      border-bottom: none;
      margin-bottom: 0;
    }

    .report-section h2 {
      margin: 0 0 4px;
      font-size: 1rem;
      color: #111827;
      border-left: 4px solid var(--ub-primary);
      padding-left: 10px;
    }

    .report-section h3 {
      margin: 6px 0 2px;
      font-size: 0.9rem;
      color: #111827;
    }

    .report-section p {
      margin: 2px 0 4px;
      font-size: 0.86rem;
    }

    .label { font-weight: 600; }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--ub-border);
      background: #f9fafb;
    }

    .pill.negative { border-color: rgba(248, 113, 113, 0.6); }

    .accent-box {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: #f9fafb;
      font-size: 0.84rem;
    }

    .accent-box strong { font-weight: 600; }

    .disclaimer {
      font-size: 0.78rem;
      color: var(--ub-muted);
      margin-top: 6px;
      border-top: 1px solid var(--ub-border);
      padding-top: 6px;
    }

    .report-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .small-heading {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--ub-muted);
      margin: 6px 0 2px;
    }

    .maps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px 16px;
      margin-top: 4px;
    }

    .maps-grid img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }

    .no-print {}

    /* Percentage scale styles */

    .percent-scale {
      margin-top: 6px;
    }

    .percent-scale-labels {
      display: flex;
      justify-content: space-between;
      font-size: 0.75rem;
      color: var(--ub-muted);
    }

    .percent-scale-bar {
  position: relative;
  height: 22px; /* thicker gradient bar */
  border-radius: 999px;
  background: linear-gradient(to right, #ef4444, #f97316, #eab308, #22c55e);
  margin: 10px 0 8px; /* slightly more spacing */
  box-shadow: 0 0 0 1px rgba(148, 163, 184, 0.5);
}

    .percent-scale-thumb-bubble {
      position: absolute;
      top: -26px;
      transform: translateX(-50%);
      padding: 3px 8px;
      border-radius: 999px;
      background: #0f172a;
      color: #f9fafb;
      font-size: 0.7rem;
      white-space: nowrap;
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.3);
    }

    .percent-scale input[type="range"] {
      width: 100%;
      margin: 4px 0 0;
    }

    .percent-scale.report-scale {
      margin-top: 4px;
    }

    .percent-scale.report-scale .percent-scale-bar {
      margin-top: 4px;
    }

    @media (max-width: 720px) {
      #report {
        padding: 20px 16px 24px;
      }
      .report-header {
        grid-template-columns: minmax(0, 1fr);
      }
      .report-meta {
        text-align: left;
      }
      .report-logo-box {
        justify-content: flex-start;
      }
    }

    @page { margin: 20mm 15mm; }

    @media print {
  * {
    -webkit-print-color-adjust: exact !important;
    print-color-adjust: exact !important;
  }

  body { background: #ffffff; }

  .page {
    padding: 0;
    max-width: none;
  }

  .main-header {
    display: none !important;
  }

  #input-panel { display: none !important; }
  #report-panel {
    display: block !important;
    box-shadow: none;
    border: none;
  }

  #report {
    box-shadow: none;
    border-radius: 0;
    border: none;
    margin: 0;
    padding: 10mm 10mm 10mm;
  }

  .no-print { display: none !important; }
  .report-section { page-break-inside: avoid; }
}

  </style>
</head>
<body>

<div class="page">
  <header class="main-header">
    <h1>URBANBRIEF</h1>
    <p>Planning Reality Report – Input Form</p>
  </header>

  <!-- INPUT PANEL -->
  <div id="input-panel" class="panel">
    <div class="panel-header">
      <div>
        <h2>Planning Reality Report – Input Checklist</h2>
        <p>Complete using the LPA website, Local Plan / SPD and Google Maps.</p>
      </div>
      <div class="badge">
        <span>Step 1</span>
        Form Inputs
      </div>
    </div>

    <form id="prrForm">
      <!-- CLIENT & SITE -->
      <div class="section">
        <div class="section-header">
          <h3>Client & Site</h3>
          <span>Basic details for the report cover.</span>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="client_name">Client name</label>
            <input type="text" id="client_name" name="client_name" placeholder="e.g. Smith Developments Ltd" />
          </div>
          <div class="field">
            <label for="client_contact_email">Client email (optional)</label>
            <input type="email" id="client_contact_email" name="client_contact_email" />
          </div>
          <div class="field">
            <label for="site_address">Site address</label>
            <input type="text" id="site_address" name="site_address" required placeholder="First line and street" />
          </div>
          <div class="field">
            <label for="site_postcode">Postcode</label>
            <input type="text" id="site_postcode" name="site_postcode" required />
          </div>
          <div class="field">
            <label for="council_name">Local planning authority</label>
            <input type="text" id="council_name" name="council_name" placeholder="e.g. London Borough of Camden" required />
          </div>
          <div class="field">
            <label for="existing_use_class">Existing use class</label>
            <input type="text" id="existing_use_class" name="existing_use_class" placeholder="e.g. C3 dwellinghouse" />
            <small class="hint">Refer to planning history / council records where available.</small>
          </div>
          <div class="field">
            <label for="proposal_summary">Proposal summary (plain English)</label>
            <textarea id="proposal_summary" name="proposal_summary" placeholder="e.g. Single-storey rear extension to a two-storey dwelling."></textarea>
          </div>
        </div>
      </div>

      <!-- SITE BASICS -->
      <div class="section">
        <div class="section-header">
          <h3>A. Site Basics</h3>
          <span>High-level classification of the site and proposal.</span>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="site_type">Site type</label>
            <select id="site_type" name="site_type">
              <option value="">Select…</option>
              <option value="res_single">Residential – single dwelling</option>
              <option value="res_flats">Residential – flats / HMO</option>
              <option value="commercial">Commercial / retail unit</option>
              <option value="mixed_use">Mixed-use</option>
              <option value="vacant_land">Vacant land</option>
              <option value="agricultural">Agricultural land / countryside</option>
              <option value="industrial">Industrial site</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="field">
            <label for="proposal_type">Proposal type</label>
            <select id="proposal_type" name="proposal_type">
              <option value="">Select…</option>
              <option value="single_storey_rear_extension">House extension – single-storey</option>
              <option value="two_storey_rear_extension">House extension – two-storey</option>
              <option value="loft_conversion">Loft conversion / dormer</option>
              <option value="outbuilding">Outbuilding / garden room / annex</option>
              <option value="change_of_use">Change of use</option>
              <option value="new_dwelling">New dwelling(s)</option>
              <option value="commercial_alterations">Commercial alterations</option>
              <option value="advertisement">Advertisement / signage</option>
              <option value="demolition">Demolition</option>
              <option value="prior_larger_home_ext">Prior Approval – Larger home extension</option>
              <option value="prior_class_ma">Prior Approval – Class MA (commercial → res)</option>
              <option value="prior_class_q">Prior Approval – Class Q (agricultural → res)</option>
              <option value="prior_other">Prior Approval – other</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="field">
            <label for="previous_applications">Previous applications on this site?</label>
            <select id="previous_applications" name="previous_applications">
              <option value="">Select…</option>
              <option value="none">No</option>
              <option value="approved">Yes – approved</option>
              <option value="refused">Yes – refused</option>
              <option value="withdrawn">Yes – withdrawn</option>
            </select>
            <small class="hint">Details entered in the Planning History section below.</small>
          </div>
        </div>

        <div class="subsection-title">Designations & location</div>
        <div class="field">
          <label>Is the site within any of the following?</label>
          <div class="inline-options">
            <label><input type="checkbox" name="designations" value="conservation_area" /> Conservation area</label>
            <label><input type="checkbox" name="designations" value="green_belt" /> Green Belt</label>
            <label><input type="checkbox" name="designations" value="aonb" /> AONB</label>
            <label><input type="checkbox" name="designations" value="national_park" /> National Park</label>
            <label><input type="checkbox" name="designations" value="world_heritage_site" /> World Heritage Site</label>
            <label><input type="checkbox" name="designations" value="article_4" /> Article 4 Direction area</label>
            <label><input type="checkbox" name="designations" value="flood_zone_1" /> Flood Zone 1</label>
            <label><input type="checkbox" name="designations" value="flood_zone_2" /> Flood Zone 2</label>
            <label><input type="checkbox" name="designations" value="flood_zone_3" /> Flood Zone 3</label>
            <label><input type="checkbox" name="designations" value="sssi" /> SSSI / SAC</label>
            <label><input type="checkbox" name="designations" value="listed_building" /> Listed building</label>
            <label><input type="checkbox" name="designations" value="locally_listed" /> Locally listed building</label>
            <label><input type="checkbox" name="designations" value="none" /> None</label>
          </div>
        </div>
      </div>

      <!-- CONTEXT & CONSTRAINTS -->
      <div class="section">
        <div class="section-header">
          <h3>B. Site Context & Constraints</h3>
          <span>Summarise key risks and sensitivities.</span>
        </div>

        <div class="field">
          <label>Known constraints</label>
          <div class="inline-options">
            <label><input type="checkbox" name="constraints" value="tpo" /> Protected trees (TPO)</label>
            <label><input type="checkbox" name="constraints" value="hedgerows" /> Important hedgerows</label>
            <label><input type="checkbox" name="constraints" value="right_of_way" /> Right of way across site</label>
            <label><input type="checkbox" name="constraints" value="contaminated" /> Contaminated land</label>
            <label><input type="checkbox" name="constraints" value="noise" /> Noise (road / rail / industrial)</label>
            <label><input type="checkbox" name="constraints" value="aqma" /> Air Quality Management Area</label>
            <label><input type="checkbox" name="constraints" value="archaeology" /> Archaeological interest</label>
            <label><input type="checkbox" name="constraints" value="heritage_sightlines" /> Heritage sightline issues</label>
            <label><input type="checkbox" name="constraints" value="unknown" /> Unknown</label>
          </div>
        </div>

        <div class="field-grid">
          <div class="field">
            <label for="visibility_public">Is the proposal visible from public viewpoints?</label>
            <select id="visibility_public" name="visibility_public">
              <option value="">Select…</option>
              <option value="prominent">Yes – prominently</option>
              <option value="partial">Yes – partially</option>
              <option value="no">No</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>

          <div class="field">
            <label for="privacy_impact">Does the proposal affect neighbours’ privacy?</label>
            <select id="privacy_impact" name="privacy_impact">
              <option value="">Select…</option>
              <option value="upper_overlooking">Yes – from new upper-floor windows/balcony</option>
              <option value="ground_overlooking">Yes – from ground floor</option>
              <option value="garden_relationship">Yes – garden relationships affected</option>
              <option value="no">No impact</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>

          <div class="field">
            <label for="daylight_impact">Does the proposal affect neighbours’ daylight/sunlight?</label>
            <select id="daylight_impact" name="daylight_impact">
              <option value="">Select…</option>
              <option value="loss_daylight">Yes – likely loss of daylight</option>
              <option value="overshadowing">Yes – likely overshadowing</option>
              <option value="no">No</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
        </div>
      </div>

      <!-- DESIGN & LAYOUT -->
      <div class="section">
        <div class="section-header">
          <h3>C. Design & Layout</h3>
          <span>Basic design parameters and neighbour relationships.</span>
        </div>

        <div class="field-grid">
          <div class="field">
            <label for="balcony_presence">Is there a proposed balcony / terrace?</label>
            <select id="balcony_presence" name="balcony_presence">
              <option value="">Select…</option>
              <option value="none">No</option>
              <option value="ground">Yes – at ground floor</option>
              <option value="upper">Yes – above ground floor</option>
            </select>
          </div>

          <div class="field">
            <label for="balcony_screening">If yes, is it screened?</label>
            <select id="balcony_screening" name="balcony_screening">
              <option value="">Select…</option>
              <option value="na">Not applicable</option>
              <option value="both_sides">Yes – both sides</option>
              <option value="one_side">Yes – one side</option>
              <option value="none">No screening</option>
            </select>
          </div>

          <div class="field">
            <label for="proposal_height">Approximate maximum height of proposal (m)</label>
            <select id="proposal_height" name="proposal_height">
              <option value="">Select…</option>
              <option value="under_2_5">&lt; 2.5m</option>
              <option value="2_5_3">2.5–3m</option>
              <option value="3_4">3–4m</option>
              <option value="4_5">4–5m</option>
              <option value="over_5">&gt; 5m</option>
            </select>
          </div>

          <div class="field">
            <label for="rear_projection">Does the extension project beyond neighbours?</label>
            <select id="rear_projection" name="rear_projection">
              <option value="">Select…</option>
              <option value="none">No</option>
              <option value="slight">Slightly</option>
              <option value="moderate">Moderately</option>
              <option value="significant">Significantly</option>
            </select>
          </div>

          <div class="field">
            <label for="materials">Proposed materials</label>
            <select id="materials" name="materials">
              <option value="">Select…</option>
              <option value="matching">Matching existing</option>
              <option value="similar">Similar to existing</option>
              <option value="contrasting">Contrasting</option>
              <option value="unknown">Unknown</option>
            </select>
          </div>
        </div>
      </div>

      <!-- POLICY & GUIDANCE -->
      <div class="section">
        <div class="section-header">
          <h3>D. Policy & Guidance Findings</h3>
          <span>Use the Local Plan, SPD documents and NPPF.</span>
        </div>

        <div class="field-grid">
          <div class="field">
            <label for="has_extension_spd">Does the council have a Residential Extensions SPD?</label>
            <select id="has_extension_spd" name="has_extension_spd">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
          <div class="field">
            <label for="spd_compliance">Does the proposal comply with the SPD?</label>
            <select id="spd_compliance" name="spd_compliance">
              <option value="">Select…</option>
              <option value="fully">Fully compliant</option>
              <option value="partial">Partially compliant</option>
              <option value="non_compliant">Non-compliant</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
          <div class="field">
            <label for="parking_compliance">Parking standards (Local Plan)</label>
            <select id="parking_compliance" name="parking_compliance">
              <option value="">Select…</option>
              <option value="meets">Meets / exceeds requirement</option>
              <option value="shortfall">Shortfall</option>
              <option value="not_applicable">Not applicable</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
          <div class="field">
            <label for="housing_mix_compliance">Housing mix / size policy (for new dwellings)</label>
            <select id="housing_mix_compliance" name="housing_mix_compliance">
              <option value="">Select…</option>
              <option value="compliant">Compliant</option>
              <option value="partial">Partially compliant</option>
              <option value="non_compliant">Non-compliant</option>
              <option value="not_applicable">Not applicable</option>
            </select>
          </div>
        </div>

        <div class="subsection-title">NPPF-level judgement</div>
        <div class="field-grid">
          <div class="field">
            <label for="nppf_sustainable">Is the site in a sustainable location?</label>
            <select id="nppf_sustainable" name="nppf_sustainable">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
              <option value="partial">Partially</option>
            </select>
          </div>
          <div class="field">
            <label for="nppf_characterscore">Character impact (NPPF)</label>
            <select id="nppf_characterscore" name="nppf_characterscore">
              <option value="">Select…</option>
              <option value="enhancement">Enhancement</option>
              <option value="low">Low impact</option>
              <option value="moderate">Moderate impact</option>
              <option value="high">High impact</option>
            </select>
          </div>
          <div class="field">
            <label for="nppf_heritage">Heritage impact (if applicable)</label>
            <select id="nppf_heritage" name="nppf_heritage">
              <option value="">Select…</option>
              <option value="no_harm">No harm</option>
              <option value="less_than_substantial">Less than substantial harm</option>
              <option value="substantial_harm">Substantial harm</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
        </div>
      </div>

      <!-- DETAILED POLICY EXTRACTS -->
      <div class="section">
        <div class="section-header">
          <h3>D2. Detailed Policy Extracts</h3>
          <span>Copy exact text from council documents.</span>
        </div>

        <div class="note">Complete at least one block. Use additional blocks if more policies are directly relevant.</div>

        <!-- Policy 1 -->
        <div class="subsection-title">Policy 1</div>
        <div class="field-grid">
          <div class="field">
            <label for="policy1_authority">Authority / council</label>
            <input type="text" id="policy1_authority" name="policy1_authority" placeholder="e.g. London Borough of Camden" />
          </div>
          <div class="field">
            <label for="policy1_doc_title">Document title</label>
            <input type="text" id="policy1_doc_title" name="policy1_doc_title" placeholder="e.g. Camden Local Plan 2017" />
          </div>
          <div class="field">
            <label for="policy1_ref">Policy reference</label>
            <input type="text" id="policy1_ref" name="policy1_ref" placeholder="e.g. Policy D1" />
          </div>
          <div class="field">
            <label for="policy1_title">Policy title</label>
            <input type="text" id="policy1_title" name="policy1_title" placeholder="e.g. Design" />
          </div>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="policy1_quote">Direct policy quote</label>
            <textarea id="policy1_quote" name="policy1_quote" placeholder="Copy and paste the relevant lines from the policy document."></textarea>
          </div>
          <div class="field">
            <label for="policy1_interp">Interpretation / comment</label>
            <textarea id="policy1_interp" name="policy1_interp" placeholder="Explain briefly how the proposal does or does not comply with this policy."></textarea>
          </div>
        </div>
        <div class="field">
          <label for="policy1_url">Source URL</label>
          <input type="url" id="policy1_url" name="policy1_url" placeholder="Link to the online policy document or PDF." />
        </div>

        <div class="divider"></div>

        <!-- Policy 2 -->
        <div class="subsection-title">Policy 2 (optional)</div>
        <div class="field-grid">
          <div class="field">
            <label for="policy2_authority">Authority / council</label>
            <input type="text" id="policy2_authority" name="policy2_authority" />
          </div>
          <div class="field">
            <label for="policy2_doc_title">Document title</label>
            <input type="text" id="policy2_doc_title" name="policy2_doc_title" />
          </div>
          <div class="field">
            <label for="policy2_ref">Policy reference</label>
            <input type="text" id="policy2_ref" name="policy2_ref" />
          </div>
          <div class="field">
            <label for="policy2_title">Policy title</label>
            <input type="text" id="policy2_title" name="policy2_title" />
          </div>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="policy2_quote">Direct policy quote</label>
            <textarea id="policy2_quote" name="policy2_quote"></textarea>
          </div>
          <div class="field">
            <label for="policy2_interp">Interpretation / comment</label>
            <textarea id="policy2_interp" name="policy2_interp"></textarea>
          </div>
        </div>
        <div class="field">
          <label for="policy2_url">Source URL</label>
          <input type="url" id="policy2_url" name="policy2_url" />
        </div>
      </div>

      <!-- TECHNICAL MATTERS -->
      <div class="section">
        <div class="section-header">
          <h3>E. Technical Matters</h3>
          <span>Drainage, highways, ecology and trees.</span>
        </div>

        <div class="field-grid">
          <div class="field">
            <label for="drainage_known">Existing drainage known?</label>
            <select id="drainage_known" name="drainage_known">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
          <div class="field">
            <label for="suds_required">Is SuDS likely to be required?</label>
            <select id="suds_required" name="suds_required">
              <option value="">Select…</option>
              <option value="yes">Yes</option>
              <option value="no">No</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
          <div class="field">
            <label for="highways_safety">Highways / access issues?</label>
            <select id="highways_safety" name="highways_safety">
              <option value="">Select…</option>
              <option value="acceptable">Visibility / access acceptable</option>
              <option value="minor_issues">Minor concerns</option>
              <option value="major_issues">Likely major issues</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
          <div class="field">
            <label for="ecology_risk">Any ecology risk (bats, habitats etc.)?</label>
            <select id="ecology_risk" name="ecology_risk">
              <option value="">Select…</option>
              <option value="none">No known risk</option>
              <option value="possible">Possible, may need survey</option>
              <option value="likely">Likely, survey expected</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
          <div class="field">
            <label for="trees_impact">Trees affected?</label>
            <select id="trees_impact" name="trees_impact">
              <option value="">Select…</option>
              <option value="none">No</option>
              <option value="tpo">Yes – TPO trees</option>
              <option value="non_tpo">Yes – non-TPO trees</option>
              <option value="unsure">Unsure</option>
            </select>
          </div>
        </div>
      </div>

      <!-- PLANNING HISTORY & PRECEDENT -->
      <div class="section">
        <div class="section-header">
          <h3>Planning History & Precedent</h3>
          <span>Site history plus nearby examples.</span>
        </div>

        <div class="subsection-title">Site Planning History – most relevant application</div>
        <div class="field-grid">
          <div class="field">
            <label for="hist1_ref">Application reference</label>
            <input type="text" id="hist1_ref" name="hist1_ref" />
          </div>
          <div class="field">
            <label for="hist1_desc">Description</label>
            <input type="text" id="hist1_desc" name="hist1_desc" />
          </div>
          <div class="field">
            <label for="hist1_decision">Decision</label>
            <select id="hist1_decision" name="hist1_decision">
              <option value="">Select…</option>
              <option value="approved">Approved</option>
              <option value="refused">Refused</option>
              <option value="withdrawn">Withdrawn</option>
              <option value="pending">Pending</option>
            </select>
          </div>
          <div class="field">
            <label for="hist1_date">Decision date (text)</label>
            <input type="text" id="hist1_date" name="hist1_date" placeholder="e.g. 12 March 2023" />
          </div>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="hist1_officer">Key officer comments (summary)</label>
            <textarea id="hist1_officer" name="hist1_officer"></textarea>
          </div>
          <div class="field">
            <label for="hist1_relevance">Why is this relevant?</label>
            <textarea id="hist1_relevance" name="hist1_relevance" placeholder="Explain what this decision tells us about how the LPA views similar proposals."></textarea>
          </div>
        </div>

        <div class="divider"></div>

        <div class="subsection-title">Nearby precedent (optional)</div>
        <div class="field-grid">
          <div class="field">
            <label for="prec1_address">Nearby address</label>
            <input type="text" id="prec1_address" name="prec1_address" />
          </div>
          <div class="field">
            <label for="prec1_ref">Council reference</label>
            <input type="text" id="prec1_ref" name="prec1_ref" />
          </div>
          <div class="field">
            <label for="prec1_desc">Description of development</label>
            <input type="text" id="prec1_desc" name="prec1_desc" />
          </div>
          <div class="field">
            <label for="prec1_decision">Decision result</label>
            <select id="prec1_decision" name="prec1_decision">
              <option value="">Select…</option>
              <option value="approved">Approved</option>
              <option value="refused">Refused</option>
            </select>
          </div>
        </div>
        <div class="field">
          <label for="prec1_relevance">Why is this precedent relevant?</label>
          <textarea id="prec1_relevance" name="prec1_relevance"></textarea>
        </div>
      </div>

      <!-- MAPS -->
      <div class="section">
        <div class="section-header">
          <h3>Maps & Street View</h3>
          <span>Links used plus automated images in the report.</span>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="maps_location_url">Google Maps URL (optional)</label>
            <input type="url" id="maps_location_url" name="maps_location_url" placeholder="https://maps.google.com/..." />
            <small class="hint">Open the red-pin location and copy the full URL from the address bar (with @lat,lng).</small>
          </div>
          <div class="field">
            <label for="maps_streetview_url">Street View URL (optional)</label>
            <input type="url" id="maps_streetview_url" name="maps_streetview_url" placeholder="https://www.google.com/maps/@..." />
            <small class="hint">Choose the clearest street view of the site and copy the full URL (with @lat,lng).</small>
          </div>
        </div>
      </div>

      <!-- PLANNING BALANCE -->
      <div class="section">
        <div class="section-header">
          <h3>Planning Balance & Risk</h3>
          <span>Overall risk level and key issues.</span>
        </div>

        <div class="field-grid">
          <div class="field">
            <label for="likelihood">Overall likelihood of approval (initial view)</label>
            <select id="likelihood" name="likelihood">
              <option value="">Select…</option>
              <option value="high">High</option>
              <option value="moderate">Moderate</option>
              <option value="low">Low</option>
              <option value="very_low">Very low</option>
            </select>
          </div>
        </div>

        <div class="subsection-title">Key benefits (tick all that apply)</div>
        <div class="field">
          <div class="inline-options">
            <label><input type="checkbox" name="benefits" value="better_accommodation" /> Better quality accommodation</label>
            <label><input type="checkbox" name="benefits" value="visual_improvement" /> Visual improvement</label>
            <label><input type="checkbox" name="benefits" value="energy_efficiency" /> Energy efficiency improvements</label>
            <label><input type="checkbox" name="benefits" value="more_space" /> Additional internal floorspace</label>
            <label><input type="checkbox" name="benefits" value="better_layout" /> Improved layout / accessibility</label>
            <label><input type="checkbox" name="benefits" value="policy_support" /> Strong policy support</label>
          </div>
        </div>

        <div class="subsection-title">Key risks / harms (tick all that apply)</div>
        <div class="field">
          <div class="inline-options">
            <label><input type="checkbox" name="risks" value="overlooking" /> Overlooking / privacy</label>
            <label><input type="checkbox" name="risks" value="overshadowing" /> Overshadowing / daylight</label>
            <label><input type="checkbox" name="risks" value="bulk_scale" /> Bulk / scale / massing</label>
            <label><input type="checkbox" name="risks" value="heritage_harm" /> Heritage impact</label>
            <label><input type="checkbox" name="risks" value="green_belt_conflict" /> Green Belt issues</label>
            <label><input type="checkbox" name="risks" value="parking_highways" /> Parking / highways</label>
            <label><input type="checkbox" name="risks" value="design_non_compliance" /> Design non-compliance</label>
            <label><input type="checkbox" name="risks" value="drainage_ecology" /> Drainage / ecology</label>
            <label><input type="checkbox" name="risks" value="neighbour_objections" /> Neighbour objections likely</label>
          </div>
        </div>

        <div class="field">
          <label for="balance_text">Planning balance (short summary)</label>
          <textarea id="balance_text" name="balance_text" placeholder="In 3–5 sentences, explain the key benefits, key risks, and the overall judgement."></textarea>
        </div>

        <div class="field">
          <label for="chance_percent">Percentage chance of approval</label>
          <div class="percent-scale">
            <div class="percent-scale-labels">
              <span>0%</span>
              <span>100%</span>
            </div>
            <div class="percent-scale-bar">
              <div class="percent-scale-thumb-bubble" id="chanceBubble">50% likelihood</div>
            </div>
            <input
              type="range"
              id="chance_percent"
              name="chance_percent"
              min="0"
              max="100"
              step="5"
              value="50"
            />
            <small class="hint">Internal numeric rating to support the narrative planning balance.</small>
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="submit" class="primary">Generate Planning Reality Report</button>
      </div>
      <p class="note">
        Once generated, use “Print / Save as PDF” on the report screen.
      </p>
    </form>
  </div>

  <!-- REPORT PANEL -->
  <div id="report-panel" class="panel">
    <div class="panel-header no-print">
      <div>
        <h2>Planning Reality Report – Preview</h2>
        <p>Review before exporting. Use this version for issuing to clients.</p>
      </div>
      <div class="badge">
        <span>Step 2</span>
        Review & Export
      </div>
    </div>

    <div class="report-actions no-print">
      <div class="actions">
        <button type="button" class="secondary" id="backToForm">Back to form</button>
        <button type="button" class="primary" id="printReport">Print / Save as PDF</button>
      </div>
    </div>

    <div id="report">
      <div class="report-header">
        <div class="report-title-block">
          <h1>Planning Reality Report</h1>
          <p><span id="r_council_name"></span> – <span id="r_site_address"></span></p>
        </div>
        <div class="report-meta">
          <div><strong>Prepared by:</strong> UrbanBrief</div>
          <div><strong>Client:</strong> <span id="r_client_name"></span></div>
        </div>
        <div class="report-logo-box">
          <img src="UB-mono.png" alt="UrbanBrief logo" class="report-logo-img" />
        </div>
      </div>

      <div class="report-section">
        <h2>1. Site & Proposal</h2>
        <p><span class="label">Site address:</span> <span id="r_site_address_2"></span>, <span id="r_site_postcode"></span></p>
        <p><span class="label">Local planning authority:</span> <span id="r_council_name_2"></span></p>
        <p><span class="label">Existing use class:</span> <span id="r_existing_use_class"></span></p>
        <p><span class="label">Site type:</span> <span id="r_site_type"></span></p>
        <p><span class="label">Proposal type:</span> <span id="r_proposal_type"></span></p>
        <p><span class="label">Proposal summary:</span> <span id="r_proposal_summary"></span></p>
      </div>

      <div class="report-section">
        <h2>2. Designations, Context & Constraints</h2>
        <h3>2.1 Policy designations</h3>
        <p><span class="label">Site designations:</span></p>
        <div class="pill-row" id="r_designations"></div>

        <h3>2.2 Local constraints</h3>
        <p><span class="label">Known constraints:</span></p>
        <div class="pill-row" id="r_constraints"></div>

        <h3>2.3 Visibility & neighbourhood impact</h3>
        <p><span class="label">Visibility from public realm:</span> <span id="r_visibility_public"></span></p>
        <p><span class="label">Privacy impact:</span> <span id="r_privacy_impact"></span></p>
        <p><span class="label">Daylight / sunlight impact:</span> <span id="r_daylight_impact"></span></p>
      </div>

      <div class="report-section">
        <h2>3. Design & Neighbour Relationships</h2>
        <p><span class="label">Balcony / terrace:</span> <span id="r_balcony"></span></p>
        <p><span class="label">Balcony screening:</span> <span id="r_balcony_screening"></span></p>
        <p><span class="label">Approximate maximum height:</span> <span id="r_height"></span></p>
        <p><span class="label">Rear projection beyond neighbours:</span> <span id="r_rear_projection"></span></p>
        <p><span class="label">Materials:</span> <span id="r_materials"></span></p>
      </div>

      <div class="report-section">
        <h2>4. Policy Context & Assessment</h2>

        <h3>4.1 Local and national policy overview</h3>
        <p><span class="label">Residential extensions SPD present:</span> <span id="r_has_spd"></span></p>
        <p><span class="label">SPD compliance:</span> <span id="r_spd_compliance"></span></p>
        <p><span class="label">Parking standards:</span> <span id="r_parking_compliance"></span></p>
        <p><span class="label">Housing mix policy (if relevant):</span> <span id="r_housing_mix_compliance"></span></p>

        <div class="accent-box">
          <strong>NPPF perspective.</strong>
          <div>Sustainability of location: <span id="r_nppf_sustainable"></span>.</div>
          <div>Impact on character and appearance: <span id="r_nppf_character"></span>.</div>
          <div>Heritage impact (where applicable): <span id="r_nppf_heritage"></span>.</div>
        </div>

        <h3>4.2 Detailed policy extracts</h3>

        <div id="r_policy1_block" style="margin-top:6px;">
          <div class="small-heading">Policy 1</div>
          <p><span class="label">Document:</span> <span id="r_policy1_doc"></span></p>
          <p><span class="label">Policy:</span> <span id="r_policy1_ref"></span> – <span id="r_policy1_title"></span></p>
          <p><span class="label">Quote:</span> <em id="r_policy1_quote"></em></p>
          <p><span class="label">Comment:</span> <span id="r_policy1_interp"></span></p>
        </div>

        <div id="r_policy2_block" style="margin-top:10px; display:none;">
          <div class="small-heading">Policy 2</div>
          <p><span class="label">Document:</span> <span id="r_policy2_doc"></span></p>
          <p><span class="label">Policy:</span> <span id="r_policy2_ref"></span> – <span id="r_policy2_title"></span></p>
          <p><span class="label">Quote:</span> <em id="r_policy2_quote"></em></p>
          <p><span class="label">Comment:</span> <span id="r_policy2_interp"></span></p>
        </div>
      </div>

      <div class="report-section">
        <h2>5. Technical Considerations</h2>
        <p><span class="label">Drainage information available:</span> <span id="r_drainage_known"></span></p>
        <p><span class="label">SuDS likely to be required:</span> <span id="r_suds_required"></span></p>
        <p><span class="label">Highways / access:</span> <span id="r_highways_safety"></span></p>
        <p><span class="label">Ecology risks:</span> <span id="r_ecology_risk"></span></p>
        <p><span class="label">Trees impact:</span> <span id="r_trees_impact"></span></p>
      </div>

      <div class="report-section">
        <h2>6. Planning History & Precedent</h2>

        <h3>6.1 Site planning history</h3>
        <p><span class="label">Most relevant application:</span> <span id="r_hist1_ref"></span></p>
        <p><span class="label">Description:</span> <span id="r_hist1_desc"></span></p>
        <p><span class="label">Decision:</span> <span id="r_hist1_decision"></span> <span id="r_hist1_date"></span></p>
        <p><span class="label">Officer comment (summary):</span> <span id="r_hist1_officer"></span></p>
        <p><span class="label">Relevance to this proposal:</span> <span id="r_hist1_relevance"></span></p>

        <h3>6.2 Nearby precedent</h3>
        <p><span class="label">Address:</span> <span id="r_prec1_address"></span></p>
        <p><span class="label">Reference:</span> <span id="r_prec1_ref"></span></p>
        <p><span class="label">Description:</span> <span id="r_prec1_desc"></span></p>
        <p><span class="label">Decision:</span> <span id="r_prec1_decision"></span></p>
        <p><span class="label">Relevance:</span> <span id="r_prec1_relevance"></span></p>
      </div>

      <div class="report-section">
        <h2>7. Location & Mapping</h2>
        <p>This report has been informed by publicly available mapping and imagery.</p>
        <p><span class="label">Google Maps location URL:</span> <span id="r_maps_location_url"></span></p>
        <p><span class="label">Street View URL:</span> <span id="r_maps_streetview_url"></span></p>

        <div class="maps-grid">
          <div id="staticMapWrapper">
            <div class="small-heading">Figure 1. Aerial context</div>
            <img id="r_static_map_img" alt="Site aerial map" />
          </div>
          <div id="streetViewWrapper">
            <div class="small-heading">Figure 2. Street view</div>
            <img id="r_streetview_img" alt="Site street view" />
          </div>
        </div>
      </div>

      <div class="report-section">
        <h2>8. Planning Balance & Indicative Conclusion</h2>
        <p><span class="label">Overall likelihood of approval (UrbanBrief assessment):</span> <span id="r_likelihood"></span></p>

        <h3>8.1 Key benefits</h3>
        <div class="pill-row" id="r_benefits"></div>

        <h3>8.2 Key risks</h3>
        <div class="pill-row" id="r_risks"></div>

        <h3>8.3 Narrative balance</h3>
        <p id="r_balance_text"></p>

        <div class="accent-box">
          <strong>UrbanBrief internal view (summary).</strong>
          <p>
            On the basis of the information available at the time of writing, this proposal is considered to have an
            overall <span id="r_likelihood_inline"></span> prospect of gaining planning permission. The planning balance
            will depend on how the local planning authority weighs the identified benefits and harms, particularly in
            relation to local design guidance, character, amenity and technical matters.
          </p>
        </div>

        <div class="subsection-title">8.4 Percentage chance of approval</div>
        <p id="r_chance_percent_text"></p>
        <div class="percent-scale report-scale">
          <div class="percent-scale-labels">
            <span>0%</span>
            <span>100%</span>
          </div>
          <div class="percent-scale-bar">
            <div class="percent-scale-thumb-bubble" id="r_chance_bubble">–</div>
          </div>
        </div>
      </div>

      <div class="disclaimer">
        <strong>Disclaimer.</strong> This Planning Reality Report has been prepared by UrbanBrief to provide an indicative,
        policy-led overview of the planning position for the identified site. It is based solely on the information
        provided and publicly available sources at the time of preparation. It does not constitute formal planning advice,
        a statutory planning statement or a guarantee of planning outcomes. Local planning authorities retain full
        discretion in determining applications and material circumstances may change over time. Clients should seek
        project-specific professional advice before committing to any course of action or financial expenditure.
      </div>
    </div>
  </div>
</div>

<script>
  // 🔑 Google Maps API key (you already enabled Static Maps + Street View)
  const GOOGLE_MAPS_API_KEY = 'AIzaSyDxSpOO_adV6pmCUpZjKKbPdEjy3ORdGxw';

  const form = document.getElementById('prrForm');
  const inputPanel = document.getElementById('input-panel');
  const reportPanel = document.getElementById('report-panel');
  const backToFormBtn = document.getElementById('backToForm');
  const printBtn = document.getElementById('printReport');

  function textVal(id) {
    const el = document.getElementById(id);
    return el && el.value ? el.value.trim() : '';
  }

  function mapSelectText(id) {
    const el = document.getElementById(id);
    if (!el) return '';
    const opt = el.options[el.selectedIndex];
    return opt && opt.text ? opt.text : '';
  }

  function fillText(id, value) {
    const el = document.getElementById(id);
    if (el) el.textContent = value || '';
  }

  function getCheckedValues(name) {
    return Array.from(document.querySelectorAll('input[name="' + name + '"]:checked')).map((i) => i.value);
  }

  function buildPills(containerId, values, labelMap, isRisk) {
    const container = document.getElementById(containerId);
    if (!container) return;
    container.innerHTML = '';
    if (!values || values.length === 0) {
      const span = document.createElement('span');
      span.textContent = 'None recorded.';
      span.style.fontSize = '0.82rem';
      span.style.color = '#6b7280';
      container.appendChild(span);
      return;
    }
    values.forEach((v) => {
      const pill = document.createElement('div');
      pill.className = 'pill' + (isRisk ? ' negative' : '');
      pill.textContent = (labelMap && labelMap[v]) || v;
      container.appendChild(pill);
    });
  }

  const labelMaps = {
    designations: {
      conservation_area: 'Conservation area',
      green_belt: 'Green Belt',
      aonb: 'Area of Outstanding Natural Beauty',
      national_park: 'National Park',
      world_heritage_site: 'World Heritage Site',
      article_4: 'Article 4 Direction',
      flood_zone_1: 'Flood Zone 1',
      flood_zone_2: 'Flood Zone 2',
      flood_zone_3: 'Flood Zone 3',
      sssi: 'SSSI / SAC',
      listed_building: 'Listed building',
      locally_listed: 'Locally listed building',
      none: 'No special designations known',
    },
    constraints: {
      tpo: 'Protected trees (TPO)',
      hedgerows: 'Important hedgerows',
      right_of_way: 'Public right of way',
      contaminated: 'Contaminated land',
      noise: 'Noise (road/rail/industrial)',
      aqma: 'Air Quality Management Area',
      archaeology: 'Archaeological interest',
      heritage_sightlines: 'Heritage sightline constraints',
      unknown: 'Constraints unknown',
    },
    benefits: {
      better_accommodation: 'Better quality accommodation',
      visual_improvement: 'Visual/streetscene improvements',
      energy_efficiency: 'Energy / sustainability benefits',
      more_space: 'Additional internal floorspace',
      better_layout: 'Improved layout / accessibility',
      policy_support: 'Strong policy support',
    },
    risks: {
      overlooking: 'Overlooking / privacy',
      overshadowing: 'Overshadowing / daylight',
      bulk_scale: 'Bulk / scale / massing',
      heritage_harm: 'Heritage impact',
      green_belt_conflict: 'Green Belt conflict',
      parking_highways: 'Parking / highways issues',
      design_non_compliance: 'Design non-compliance',
      drainage_ecology: 'Drainage / ecology issues',
      neighbour_objections: 'Neighbour objections likely',
    },
  };

  // Pull "lat,lng" from a Google Maps / Street View URL if present
  function latLngFromGoogleUrl(url) {
  if (!url) return null;
  try {
    // Look for @lat,lng in the URL, e.g. @52.123456,-1.234567
    const m = url.match(/@(-?\d+\.?\d*),(-?\d+\.?\d*)/);
    if (m) return m[1] + ',' + m[2];
  } catch (e) {}
  return null;
}

  form.addEventListener('submit', function (e) {
    e.preventDefault();

    const clientName = textVal('client_name');
    const siteAddress = textVal('site_address');
    const sitePostcode = textVal('site_postcode');
    const councilName = textVal('council_name');
    const existingUse = textVal('existing_use_class');
    const proposalSummary = textVal('proposal_summary');

    fillText('r_client_name', clientName || '—');
    fillText('r_site_address', siteAddress);
    fillText('r_site_address_2', siteAddress);
    fillText('r_site_postcode', sitePostcode);
    fillText('r_council_name', councilName);
    fillText('r_council_name_2', councilName);
    fillText('r_existing_use_class', existingUse || 'Not specified');
    fillText('r_proposal_summary', proposalSummary || 'Not provided.');

    const siteTypeText = mapSelectText('site_type') || 'Not specified';
    const proposalTypeText = mapSelectText('proposal_type') || 'Not specified';
    fillText('r_site_type', siteTypeText);
    fillText('r_proposal_type', proposalTypeText);

    // Designations & constraints
    const designations = getCheckedValues('designations');
    const constraints = getCheckedValues('constraints');
    buildPills('r_designations', designations, labelMaps.designations, false);
    buildPills('r_constraints', constraints, labelMaps.constraints, false);

    // Context
    fillText('r_visibility_public', mapSelectText('visibility_public') || 'Not specified');
    fillText('r_privacy_impact', mapSelectText('privacy_impact') || 'Not specified');
    fillText('r_daylight_impact', mapSelectText('daylight_impact') || 'Not specified');

    // Design
    fillText('r_balcony', mapSelectText('balcony_presence') || 'Not specified');
    fillText('r_balcony_screening', mapSelectText('balcony_screening') || 'Not specified');
    fillText('r_height', mapSelectText('proposal_height') || 'Not specified');
    fillText('r_rear_projection', mapSelectText('rear_projection') || 'Not specified');
    fillText('r_materials', mapSelectText('materials') || 'Not specified');

    // Policy-level
    fillText('r_has_spd', mapSelectText('has_extension_spd') || 'Not specified');
    fillText('r_spd_compliance', mapSelectText('spd_compliance') || 'Not specified');
    fillText('r_parking_compliance', mapSelectText('parking_compliance') || 'Not specified');
    fillText('r_housing_mix_compliance', mapSelectText('housing_mix_compliance') || 'Not specified');
    fillText('r_nppf_sustainable', mapSelectText('nppf_sustainable') || 'Not specified');
    fillText('r_nppf_character', mapSelectText('nppf_characterscore') || 'Not specified');
    fillText('r_nppf_heritage', mapSelectText('nppf_heritage') || 'Not specified');

    // Policy 1
    const policy1Doc = textVal('policy1_doc_title');
    const policy1Authority = textVal('policy1_authority');
    let policy1DocCombined = '';
    if (policy1Doc && policy1Authority) {
      policy1DocCombined = policy1Doc + ' (' + policy1Authority + ')';
    } else {
      policy1DocCombined = policy1Doc || policy1Authority || 'Not specified';
    }
    fillText('r_policy1_doc', policy1DocCombined);
    fillText('r_policy1_ref', textVal('policy1_ref'));
    fillText('r_policy1_title', textVal('policy1_title'));
    fillText('r_policy1_quote', textVal('policy1_quote'));
    fillText('r_policy1_interp', textVal('policy1_interp'));

    // Policy 2
    const policy2Doc = textVal('policy2_doc_title');
    const policy2Authority = textVal('policy2_authority');
    const policy2Any = policy2Doc || policy2Authority || textVal('policy2_ref') || textVal('policy2_quote');
    const policy2Block = document.getElementById('r_policy2_block');
    if (policy2Any) {
      let policy2DocCombined = '';
      if (policy2Doc && policy2Authority) {
        policy2DocCombined = policy2Doc + ' (' + policy2Authority + ')';
      } else {
        policy2DocCombined = policy2Doc || policy2Authority || 'Not specified';
      }
      fillText('r_policy2_doc', policy2DocCombined);
      fillText('r_policy2_ref', textVal('policy2_ref'));
      fillText('r_policy2_title', textVal('policy2_title'));
      fillText('r_policy2_quote', textVal('policy2_quote'));
      fillText('r_policy2_interp', textVal('policy2_interp'));
      policy2Block.style.display = 'block';
    } else {
      policy2Block.style.display = 'none';
    }

    // Technical
    fillText('r_drainage_known', mapSelectText('drainage_known') || 'Not specified');
    fillText('r_suds_required', mapSelectText('suds_required') || 'Not specified');
    fillText('r_highways_safety', mapSelectText('highways_safety') || 'Not specified');
    fillText('r_ecology_risk', mapSelectText('ecology_risk') || 'Not specified');
    fillText('r_trees_impact', mapSelectText('trees_impact') || 'Not specified');

    // History & precedent
    fillText('r_hist1_ref', textVal('hist1_ref'));
    fillText('r_hist1_desc', textVal('hist1_desc'));
    fillText('r_hist1_decision', mapSelectText('hist1_decision') || 'Not specified');
    fillText('r_hist1_date', textVal('hist1_date') ? ' – ' + textVal('hist1_date') : '');
    fillText('r_hist1_officer', textVal('hist1_officer') || 'Not summarised.');
    fillText('r_hist1_relevance', textVal('hist1_relevance') || 'Not explained.');

    fillText('r_prec1_address', textVal('prec1_address'));
    fillText('r_prec1_ref', textVal('prec1_ref'));
    fillText('r_prec1_desc', textVal('prec1_desc'));
    fillText('r_prec1_decision', mapSelectText('prec1_decision') || 'Not specified');
    fillText('r_prec1_relevance', textVal('prec1_relevance') || 'Not explained.');

    // Maps – text URLs
    const mapsLocationUrl = textVal('maps_location_url');
    const mapsStreetViewUrl = textVal('maps_streetview_url');
    fillText('r_maps_location_url', mapsLocationUrl || 'Not provided');
    fillText('r_maps_streetview_url', mapsStreetViewUrl || 'Not provided');

    // Maps – images (LINKS ONLY)
    const staticMapImg = document.getElementById('r_static_map_img');
    const streetViewImg = document.getElementById('r_streetview_img');

    const hasKey = GOOGLE_MAPS_API_KEY && GOOGLE_MAPS_API_KEY.trim() !== '';
    if (hasKey && (mapsLocationUrl || mapsStreetViewUrl)) {
      const locLatLng = latLngFromGoogleUrl(mapsLocationUrl);
      const svLatLng = latLngFromGoogleUrl(mapsStreetViewUrl);

      const baseLatLng = locLatLng || svLatLng;

      if (baseLatLng) {
        const staticCenter = baseLatLng;
        const streetLocation = svLatLng || baseLatLng;

        const staticMapUrl =
          'https://maps.googleapis.com/maps/api/staticmap?center=' +
          encodeURIComponent(staticCenter) +
          '&zoom=18&size=640x360&maptype=satellite&markers=color:red|' +
          encodeURIComponent(staticCenter) +
          '&key=' +
          encodeURIComponent(GOOGLE_MAPS_API_KEY);

        const streetViewUrl =
          'https://maps.googleapis.com/maps/api/streetview?size=640x360&location=' +
          encodeURIComponent(streetLocation) +
          '&key=' +
          encodeURIComponent(GOOGLE_MAPS_API_KEY);

        staticMapImg.src = staticMapUrl;
        staticMapImg.alt = 'Site aerial map';
        streetViewImg.src = streetViewUrl;
        streetViewImg.alt = 'Site street view';
      } else {
        staticMapImg.removeAttribute('src');
        staticMapImg.alt = 'Static map not available – use a full Google Maps URL that contains @lat,lng.';
        streetViewImg.removeAttribute('src');
        streetViewImg.alt = 'Street view not available – use a full Street View URL that contains @lat,lng.';
      }
    } else {
      staticMapImg.removeAttribute('src');
      staticMapImg.alt = 'Static map not available – add Google Maps and Street View URLs.';
      streetViewImg.removeAttribute('src');
      streetViewImg.alt = 'Street view not available – add Google Maps and Street View URLs.';
    }

    // Planning balance
    const likelihoodValue = mapSelectText('likelihood');
    const likelihoodText = likelihoodValue
      ? likelihoodValue.charAt(0).toUpperCase() + likelihoodValue.slice(1)
      : 'Not specified';
    fillText('r_likelihood', likelihoodText);
    fillText('r_likelihood_inline', likelihoodText.toLowerCase());

    const benefits = getCheckedValues('benefits');
    const risks = getCheckedValues('risks');
    buildPills('r_benefits', benefits, labelMaps.benefits, false);
    buildPills('r_risks', risks, labelMaps.risks, true);

    const balanceText =
      textVal('balance_text') ||
      'A narrative planning balance has not been provided. This section should be completed before issuing to the client.';
    fillText('r_balance_text', balanceText);

    // Percentage chance of approval (numeric)
    const chanceInput = document.getElementById('chance_percent');
    const chanceValue = chanceInput ? parseInt(chanceInput.value || '0', 10) : 0;
    const safeChance = Math.max(0, Math.min(100, isNaN(chanceValue) ? 0 : chanceValue));

    const chanceTextEl = document.getElementById('r_chance_percent_text');
    if (chanceTextEl) {
      chanceTextEl.textContent =
        'Internal percentage chance of approval: ' + safeChance + '% (supporting the narrative assessment above).';
    }

    const reportBubble = document.getElementById('r_chance_bubble');
    if (reportBubble) {
      reportBubble.textContent = safeChance + '% likelihood rating';
      reportBubble.style.left = safeChance + '%';
    }

    // Set document title so PDF filename defaults to UB-PRR-{POSTCODE}-01
    const postcodeNoSpaces = (sitePostcode || '').replace(/\\s+/g, '');
    if (postcodeNoSpaces) {
      document.title = 'UB-PRR-' + postcodeNoSpaces.toUpperCase() + '-01';
    } else {
      document.title = 'UB-PRR-REPORT';
    }

    // Show report
    inputPanel.style.display = 'none';
    reportPanel.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  // Live update for the percentage chance bubble on the form
  const chanceInputForm = document.getElementById('chance_percent');
  const chanceBubbleForm = document.getElementById('chanceBubble');

  function updateChanceBubbleForm() {
    if (!chanceInputForm || !chanceBubbleForm) return;
    const val = parseInt(chanceInputForm.value || '0', 10);
    const safeVal = Math.max(0, Math.min(100, isNaN(val) ? 0 : val));
    chanceBubbleForm.textContent = safeVal + '% likelihood';
    chanceBubbleForm.style.left = safeVal + '%';
  }

  if (chanceInputForm && chanceBubbleForm) {
    chanceInputForm.addEventListener('input', updateChanceBubbleForm);
    updateChanceBubbleForm();
  }

  backToFormBtn.addEventListener('click', function () {
    reportPanel.style.display = 'none';
    inputPanel.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  printBtn.addEventListener('click', function () {
    window.print();
  });
</script>
</body>
</html>
