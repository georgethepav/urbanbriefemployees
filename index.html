<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>UrbanBrief ‚Äì Planning Reality Report Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root {
      --ub-primary: #1f4f7b;
      --ub-secondary: #f5f7fb;
      --ub-border: #dde2ed;
      --ub-text: #111827;
      --ub-muted: #6b7280;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--ub-secondary);
      color: var(--ub-text);
      line-height: 1.5;
    }

    a {
      color: var(--ub-primary);
    }

    .page {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px 16px 48px;
    }

    header.main-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
      gap: 16px;
    }

    .logo-lockup {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-mark {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      border: 2px solid var(--ub-primary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      color: var(--ub-primary);
      background: white;
      font-size: 1.2rem;
    }

    .logo-text h1 {
      margin: 0;
      font-size: 1.1rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--ub-primary);
    }

    .logo-text p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--ub-muted);
    }

    .tagline {
      font-size: 0.85rem;
      color: var(--ub-muted);
      text-align: right;
    }

    .panel {
      background: white;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      padding: 24px 20px 28px;
      margin-bottom: 24px;
      border: 1px solid var(--ub-border);
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
      gap: 12px;
    }

    .panel-header h2 {
      margin: 0;
      font-size: 1.1rem;
    }

    .panel-header p {
      margin: 0;
      font-size: 0.85rem;
      color: var(--ub-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-size: 0.75rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: rgba(31, 79, 123, 0.05);
      color: var(--ub-primary);
    }

    .badge span {
      font-weight: 600;
      font-size: 0.8rem;
    }

    form {
      display: grid;
      gap: 18px;
    }

    .section {
      border-radius: 12px;
      border: 1px solid var(--ub-border);
      padding: 14px 14px 8px;
      background: #ffffff;
    }

    .section-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 8px;
      border-left: 4px solid var(--ub-primary);
      padding-left: 10px;
    }

    .section-header h3 {
      margin: 0;
      font-size: 0.95rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--ub-primary);
    }

    .section-header span {
      font-size: 0.8rem;
      color: var(--ub-muted);
    }

    .field-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px 16px;
      margin-bottom: 10px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field label {
      font-size: 0.85rem;
      font-weight: 600;
      color: #374151;
    }

    .field small {
      font-size: 0.75rem;
      color: var(--ub-muted);
    }

    input[type="text"],
    input[type="email"],
    input[type="url"],
    select,
    textarea {
      border-radius: 8px;
      border: 1px solid var(--ub-border);
      padding: 7px 9px;
      font-size: 0.9rem;
      font-family: inherit;
      background: #f9fafb;
      transition: border-color 0.15s, box-shadow 0.15s, background 0.15s;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--ub-primary);
      box-shadow: 0 0 0 2px rgba(31, 79, 123, 0.15);
      background: white;
    }

    textarea {
      min-height: 70px;
      resize: vertical;
    }

    .inline-options {
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      font-size: 0.85rem;
    }

    .inline-options label {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      font-weight: 500;
      color: #374151;
    }

    .inline-options input[type="checkbox"],
    .inline-options input[type="radio"] {
      accent-color: var(--ub-primary);
    }

    .subsection-title {
      font-size: 0.85rem;
      font-weight: 700;
      color: #111827;
      margin: 4px 0 2px;
    }

    .divider {
      border-top: 1px dashed var(--ub-border);
      margin: 8px 0 6px;
    }

    .hint {
      font-size: 0.8rem;
      color: var(--ub-muted);
      margin-top: 2px;
    }

    .actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }

    button {
      border-radius: 999px;
      border: none;
      padding: 8px 16px;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.1s ease;
    }

    button.primary {
      background: var(--ub-primary);
      color: white;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.25);
    }

    button.secondary {
      background: white;
      color: var(--ub-primary);
      border: 1px solid var(--ub-border);
    }

    button:hover {
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: none;
    }

    .note {
      font-size: 0.8rem;
      color: var(--ub-muted);
      margin-top: 6px;
    }

    /* REPORT STYLES */

    #report-panel {
      display: none;
    }

    #report {
      max-width: 900px;
      margin: 0 auto;
      padding: 32px 30px 36px;
      background: #ffffff;
      border-radius: 16px;
      border: 1px solid var(--ub-border);
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
    }

    .report-header {
      border-radius: 14px;
      border: 1px solid var(--ub-border);
      background: linear-gradient(120deg, #ffffff, #eef3fb);
      padding: 14px 16px 12px;
      display: grid;
      grid-template-columns: minmax(0, 1.5fr) minmax(0, 1.2fr) auto;
      gap: 12px;
      margin-bottom: 14px;
      border-top: 5px solid var(--ub-primary);
    }

    .report-title-block h1 {
      margin: 0;
      font-size: 1.4rem;
      letter-spacing: 0.12em;
      text-transform: uppercase;
      color: var(--ub-primary);
    }

    .report-title-block p {
      margin: 4px 0 0;
      font-size: 0.85rem;
      color: var(--ub-muted);
    }

    .report-meta {
      text-align: right;
      font-size: 0.8rem;
      color: var(--ub-muted);
    }

    .report-meta div {
      margin-bottom: 2px;
    }

    .report-meta .internal-tag {
      font-weight: 600;
      color: var(--ub-primary);
    }

    .report-logo-box {
      display: flex;
      justify-content: flex-end;
      align-items: center;
    }

    .report-logo-img {
      max-height: 60px;
      max-width: 120px;
    }

    .report-section {
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
    }

    .report-section:last-of-type {
      border-bottom: none;
      margin-bottom: 0;
    }

    .report-section h2 {
      margin: 0 0 4px;
      font-size: 1rem;
      color: #111827;
      border-left: 4px solid var(--ub-primary);
      padding-left: 10px;
    }

    .report-section h3 {
      margin: 6px 0 2px;
      font-size: 0.9rem;
      color: #111827;
    }

    .report-section p {
      margin: 2px 0 4px;
      font-size: 0.86rem;
    }

    .label {
      font-weight: 600;
    }

    .pill-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      margin-top: 4px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      border: 1px solid var(--ub-border);
      background: #f9fafb;
    }

    .pill.negative {
      border-color: rgba(248, 113, 113, 0.6);
    }

    .accent-box {
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px dashed rgba(148, 163, 184, 0.7);
      background: #f9fafb;
      font-size: 0.84rem;
    }

    .accent-box strong {
      font-weight: 600;
    }

    .disclaimer {
      font-size: 0.78rem;
      color: var(--ub-muted);
      margin-top: 6px;
      border-top: 1px solid var(--ub-border);
      padding-top: 6px;
    }

    .report-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .small-heading {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--ub-muted);
      margin: 6px 0 2px;
    }

    .maps-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 10px 16px;
      margin-top: 4px;
    }

    .maps-grid img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
    }

    .no-print {
      /* just a marker */
    }

    /* PRINT HEADER / FOOTER */

    .print-header,
    .print-footer {
      display: none;
    }

    .print-header-inner,
    .print-footer-inner {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.78rem;
      color: var(--ub-muted);
    }

    .print-header-inner span,
    .print-footer-inner span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    @media (max-width: 720px) {
      header.main-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .tagline {
        text-align: left;
      }
      .report-header {
        grid-template-columns: minmax(0, 1fr);
      }
      .report-meta {
        text-align: left;
      }
      .report-logo-box {
        justify-content: flex-start;
      }
    }

    @page {
      margin: 20mm 15mm;
    }

    @media print {
      body {
        background: #ffffff;
      }

      .page {
        padding: 0;
        max-width: none;
      }

      #input-panel {
        display: none !important;
      }

      #report-panel {
        display: block !important;
        box-shadow: none;
        border: none;
      }

      #report {
        box-shadow: none;
        border-radius: 0;
        border: none;
        margin: 0;
        padding: 20mm 15mm 18mm;
      }

      .no-print {
        display: none !important;
      }

      .print-header,
      .print-footer {
        display: block;
        position: fixed;
        left: 0;
        right: 0;
        font-size: 0.78rem;
        color: var(--ub-muted);
        padding: 3mm 15mm;
        background: #ffffff;
        z-index: 1000;
      }

      .print-header {
        top: 0;
        border-bottom: 1px solid #e5e7eb;
      }

      .print-footer {
        bottom: 0;
        border-top: 1px solid #e5e7eb;
      }

      .page-number::before {
        content: "Page " counter(page);
      }

      #report {
        margin-top: 18mm;
        margin-bottom: 14mm;
      }

      .report-section {
        page-break-inside: avoid;
      }
    }
  </style>
</head>
<body>

<!-- PRINT HEADER / FOOTER (PRINT-ONLY) -->
<div class="print-header">
  <div class="print-header-inner">
    <span id="printHeaderMain">Urban Brief ‚Äì Planning Reality Report</span>
  </div>
</div>
<div class="print-footer">
  <div class="print-footer-inner">
    <span id="printFooterMain">Urban Brief ‚Äì Planning Reality Report</span>
    <span class="page-number"></span>
  </div>
</div>

<div class="page">
  <header class="main-header">
    <div class="logo-lockup">
      <div class="logo-mark">UB</div>
      <div class="logo-text">
        <h1>UrbanBrief</h1>
        <p>Planning Reality Report ‚Äì Input Form</p>
      </div>
    </div>
    <div class="tagline">
      <div>Complete using the relevant LPA website, policy documents and mapping.</div>
    </div>
  </header>

  <!-- INPUT PANEL -->
  <div id="input-panel" class="panel">
    <div class="panel-header">
      <div>
        <h2>Planning Reality Report ‚Äì Input Checklist</h2>
        <p>Work through each section using the council website, Local Plan / SPD documents and Google Maps.</p>
      </div>
      <div class="badge">
        <span>Step 1</span>
        Form Inputs
      </div>
    </div>

    <form id="prrForm">
      <!-- CLIENT & SITE -->
      <div class="section">
        <div class="section-header">
          <h3>Client & Site</h3>
          <span>Basic details for the report cover.</span>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="client_name">Client name</label>
            <input type="text" id="client_name" name="client_name" placeholder="e.g. Smith Developments Ltd" />
          </div>
          <div class="field">
            <label for="site_address">Site address</label>
            <input type="text" id="site_address" name="site_address" required placeholder="First line and street" />
          </div>
          <div class="field">
            <label for="site_postcode">Postcode</label>
            <input type="text" id="site_postcode" name="site_postcode" required />
          </div>
          <div class="field">
            <label for="council_name">Local planning authority</label>
            <input type="text" id="council_name" name="council_name" placeholder="e.g. London Borough of Camden" required />
          </div>
          <div class="field">
            <label for="existing_use_class">Existing use class</label>
            <input type="text" id="existing_use_class" name="existing_use_class" placeholder="e.g. C3 dwellinghouse" />
            <small class="hint">Refer to planning history / council records where available.</small>
          </div>
          <div class="field">
            <label for="proposal_summary">Proposal summary (plain English)</label>
            <textarea id="proposal_summary" name="proposal_summary" placeholder="e.g. Single-storey rear extension to a two-storey dwelling."></textarea>
          </div>
        </div>
      </div>

      <!-- SITE BASICS -->
      <div class="section">
        <div class="section-header">
          <h3>A. Site Basics</h3>
          <span>High-level classification of the site and proposal.</span>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="site_type">Site type</label>
            <select id="site_type" name="site_type">
              <option value="">Select‚Ä¶</option>
              <option value="res_single">Residential ‚Äì single dwelling</option>
              <option value="res_flats">Residential ‚Äì flats / HMO</option>
              <option value="commercial">Commercial / retail unit</option>
              <option value="mixed_use">Mixed-use</option>
              <option value="vacant_land">Vacant land</option>
              <option value="agricultural">Agricultural land / countryside</option>
              <option value="industrial">Industrial site</option>
              <option value="other">Other</option>
            </select>
          </div>

          <div class="field">
            <label for="proposal_type">Proposal type</label>
            <select id="proposal_type" name="proposal_type">
              <option value="">Select‚Ä¶</option>
              <option value="single_storey_rear_extension">House extension ‚Äì single-storey</option>
              <option value="two_storey_rear_extension">House extension ‚Äì two-storey</option>
              <option value="loft_conversion">Loft conversion / dormer</option>
              <option value="outbuilding">Outbuilding / garden room / annex</option>
              <option value="change_of_use">Change of use</option>
              <option value="new_dwelling">New dwelling(s)</option>
              <option value="commercial_alterations">Commercial alterations</option>
              <option value="advertisement">Advertisement / signage</option>
              <option value="demolition">Demolition</option>
              <option value="prior_larger_home_ext">Prior Approval ‚Äì Larger home extension</option>
              <option value="prior_class_ma">Prior Approval ‚Äì Class MA (commercial ‚Üí res)</option>
              <option value="prior_class_q">Prior Approval ‚Äì Class Q (agricultural ‚Üí res)</option>
              <option value="prior_other">Prior Approval ‚Äì other</option>
              <option value="other">Other</option>
            </select>
          </div>
        </div>
      </div>

      <!-- POLICY SNAPSHOT (kept shorter for sanity) -->
      <div class="section">
        <div class="section-header">
          <h3>Policy & Risk Snapshot</h3>
          <span>Quick view of how risky it feels.</span>
        </div>

        <div class="field-grid">
          <div class="field">
            <label for="likelihood">Overall likelihood of approval (initial view)</label>
            <select id="likelihood" name="likelihood">
              <option value="">Select‚Ä¶</option>
              <option value="High">High</option>
              <option value="Moderate">Moderate</option>
              <option value="Low">Low</option>
              <option value="Very low">Very low</option>
            </select>
          </div>
          <div class="field">
            <label for="key_issues">Headline issues (comma separated)</label>
            <input type="text" id="key_issues" name="key_issues" placeholder="e.g. Overlooking, bulk/scale, highways" />
          </div>
        </div>

        <div class="field">
          <label for="balance_text">Planning balance (short narrative)</label>
          <textarea id="balance_text" name="balance_text" placeholder="In 3‚Äì5 sentences, explain the key benefits, key risks, and overall judgement."></textarea>
        </div>
      </div>

      <!-- MAPS -->
      <div class="section">
        <div class="section-header">
          <h3>Maps & Street View</h3>
          <span>Optional reference URLs for the file.</span>
        </div>
        <div class="field-grid">
          <div class="field">
            <label for="maps_location_url">Google Maps URL (optional)</label>
            <input type="url" id="maps_location_url" name="maps_location_url" placeholder="https://maps.google.com/..." />
          </div>
          <div class="field">
            <label for="maps_streetview_url">Street View URL (optional)</label>
            <input type="url" id="maps_streetview_url" name="maps_streetview_url" placeholder="https://www.google.com/maps/@..." />
          </div>
        </div>
      </div>

      <div class="actions">
        <button type="submit" class="primary">Generate Planning Reality Report</button>
      </div>
      <p class="note">
        Once generated, use ‚ÄúPrint / Save as PDF‚Äù on the report screen.  
        In the print dialog, **untick browser ‚ÄúHeaders and footers‚Äù** ‚Äì our own header/footer are built in.
      </p>
    </form>
  </div>

  <!-- REPORT PANEL -->
  <div id="report-panel" class="panel">
    <div class="panel-header no-print">
      <div>
        <h2>Planning Reality Report ‚Äì Preview</h2>
        <p>Review before exporting. Use this version for issuing to clients.</p>
      </div>
      <div class="badge">
        <span>Step 2</span>
        Review & Export
      </div>
    </div>

    <div class="report-actions no-print">
      <div class="actions">
        <button type="button" class="secondary" id="backToForm">Back to form</button>
        <button type="button" class="primary" id="printReport">Print / Save as PDF</button>
      </div>
      <p class="note">
        In the print dialog, choose ‚ÄúSave as PDF‚Äù and untick **Headers and footers** so only the UrbanBrief header/footer show.
      </p>
    </div>

    <div id="report">
      <div class="report-header">
        <div class="report-title-block">
          <h1>Planning Reality Report</h1>
          <p><span id="r_council_name"></span> ‚Äì <span id="r_site_address"></span></p>
        </div>
        <div class="report-meta">
          <div><strong>Prepared by:</strong> UrbanBrief</div>
          <div><strong>Client:</strong> <span id="r_client_name"></span></div>
          <div class="internal-tag">For internal UrbanBrief use only</div>
        </div>
        <div class="report-logo-box">
          <!-- expects UB-mono.svg in same folder -->
          <img src="UB-mono.svg" alt="UrbanBrief logo" class="report-logo-img" />
        </div>
      </div>

      <div class="report-section">
        <h2>1. Site & Proposal</h2>
        <p><span class="label">Site address:</span> <span id="r_site_address_2"></span>, <span id="r_site_postcode"></span></p>
        <p><span class="label">Local planning authority:</span> <span id="r_council_name_2"></span></p>
        <p><span class="label">Existing use class:</span> <span id="r_existing_use_class"></span></p>
        <p><span class="label">Site type:</span> <span id="r_site_type"></span></p>
        <p><span class="label">Proposal type:</span> <span id="r_proposal_type"></span></p>
        <p><span class="label">Proposal summary:</span> <span id="r_proposal_summary"></span></p>
      </div>

      <div class="report-section">
        <h2>2. Policy & Risk Snapshot</h2>
        <p><span class="label">Overall likelihood of approval:</span> <span id="r_likelihood"></span></p>
        <p><span class="label">Headline issues:</span> <span id="r_key_issues"></span></p>
        <div class="accent-box">
          <strong>Planning balance.</strong>
          <p id="r_balance_text"></p>
        </div>
      </div>

      <div class="report-section">
        <h2>3. Location & Mapping</h2>
        <p>This report has been informed by publicly available mapping and imagery.</p>
        <p><span class="label">Google Maps location URL:</span> <span id="r_maps_location_url"></span></p>
        <p><span class="label">Street View URL:</span> <span id="r_maps_streetview_url"></span></p>

        <div class="maps-grid">
          <div id="staticMapWrapper">
            <div class="small-heading">Figure 1. Aerial context</div>
            <img id="r_static_map_img" alt="Site aerial map" />
          </div>
          <div id="streetViewWrapper">
            <div class="small-heading">Figure 2. Street view</div>
            <img id="r_streetview_img" alt="Site street view" />
          </div>
        </div>
      </div>

      <div class="report-section">
        <h2>4. Overall View</h2>
        <div class="accent-box">
          <strong>UrbanBrief internal view (summary).</strong>
          <p>
            On the basis of the information available at the time of writing, this proposal is considered to have an
            overall <span id="r_likelihood_inline"></span> prospect of gaining planning permission. The planning balance
            will depend on how the local planning authority weighs the identified benefits and harms, particularly in
            relation to local design guidance, character, amenity and technical matters.
          </p>
        </div>
      </div>

      <div class="disclaimer">
        <strong>Disclaimer.</strong> This Planning Reality Report has been prepared by UrbanBrief to provide an indicative,
        policy-led overview of the planning position for the identified site. It is based solely on the information
        provided and publicly available sources at the time of preparation. It does not constitute formal planning advice,
        a statutory planning statement or a guarantee of planning outcomes. Local planning authorities retain full
        discretion in determining applications and material circumstances may change over time. Clients should seek
        project-specific professional advice before committing to any course of action or financial expenditure.
      </div>
    </div>
  </div>
</div>

<script>
  // üîë IMPORTANT: put your real key here
  // e.g. const GOOGLE_MAPS_API_KEY = 'AIza...';
  const GOOGLE_MAPS_API_KEY = 'AIzaSyDxSpOO_adV6pmCUpZjKKbPdEjy3ORdGxw';

  const form = document.getElementById('prrForm');
  const inputPanel = document.getElementById('input-panel');
  const reportPanel = document.getElementById('report-panel');
  const backToFormBtn = document.getElementById('backToForm');
  const printBtn = document.getElementById('printReport');

  function textVal(id) {
    const el = document.getElementById(id);
    return el && el.value ? el.value.trim() : '';
  }

  function mapSelectText(id) {
    const el = document.getElementById(id);
    if (!el) return '';
    const opt = el.options[el.selectedIndex];
    return opt && opt.text ? opt.text : '';
  }

  function fillText(id, value) {
    const el = document.getElementById(id);
    if (el) el.textContent = value || '';
  }

  form.addEventListener('submit', function (e) {
    e.preventDefault();

    const clientName = textVal('client_name');
    const siteAddress = textVal('site_address');
    const sitePostcode = textVal('site_postcode');
    const councilName = textVal('council_name');
    const existingUse = textVal('existing_use_class');
    const proposalSummary = textVal('proposal_summary');

    // Fill basic fields
    fillText('r_client_name', clientName || '‚Äî');
    fillText('r_site_address', siteAddress);
    fillText('r_site_address_2', siteAddress);
    fillText('r_site_postcode', sitePostcode);
    fillText('r_council_name', councilName);
    fillText('r_council_name_2', councilName);
    fillText('r_existing_use_class', existingUse || 'Not specified');
    fillText('r_proposal_summary', proposalSummary || 'Not provided.');

    const siteTypeText = mapSelectText('site_type') || 'Not specified';
    const proposalTypeText = mapSelectText('proposal_type') || 'Not specified';
    fillText('r_site_type', siteTypeText);
    fillText('r_proposal_type', proposalTypeText);

    const likelihoodText = mapSelectText('likelihood') || 'Not specified';
    fillText('r_likelihood', likelihoodText);
    fillText('r_likelihood_inline', likelihoodText.toLowerCase());

    const keyIssues = textVal('key_issues');
    fillText('r_key_issues', keyIssues || 'None highlighted.');

    const balanceText =
      textVal('balance_text') ||
      'A narrative planning balance has not been provided. This section should be completed before issuing to the client.';
    fillText('r_balance_text', balanceText);

    const mapsLocationUrl = textVal('maps_location_url');
    const mapsStreetViewUrl = textVal('maps_streetview_url');
    fillText('r_maps_location_url', mapsLocationUrl || 'Not provided');
    fillText('r_maps_streetview_url', mapsStreetViewUrl || 'Not provided');

    // Header/footer text based on first line of address
    const firstLine = siteAddress.split(',')[0] || siteAddress || 'Site address';
    const headerFooterText = 'Urban Brief ‚Äì Planning Reality Report ‚Äì ' + firstLine;
    fillText('printHeaderMain', headerFooterText);
    fillText('printFooterMain', headerFooterText);

    // Maps
    const staticMapWrapper = document.getElementById('staticMapWrapper');
    const streetViewWrapper = document.getElementById('streetViewWrapper');
    const staticMapImg = document.getElementById('r_static_map_img');
    const streetViewImg = document.getElementById('r_streetview_img');

    if (
      GOOGLE_MAPS_API_KEY &&
      GOOGLE_MAPS_API_KEY !== 'YOUR_GOOGLE_MAPS_API_KEY_HERE' &&
      (siteAddress || sitePostcode)
    ) {
      const query = encodeURIComponent((siteAddress + ' ' + sitePostcode).trim());

      const staticMapUrl =
        'https://maps.googleapis.com/maps/api/staticmap?center=' +
        query +
        '&zoom=18&size=640x360&maptype=satellite&markers=color:red|' +
        query +
        '&key=' +
        encodeURIComponent(GOOGLE_MAPS_API_KEY);

      const streetViewUrl =
        'https://maps.googleapis.com/maps/api/streetview?size=640x360&location=' +
        query +
        '&key=' +
        encodeURIComponent(GOOGLE_MAPS_API_KEY);

      staticMapImg.src = staticMapUrl;
      streetViewImg.src = streetViewUrl;
      staticMapWrapper.style.display = 'block';
      streetViewWrapper.style.display = 'block';
    } else {
      staticMapWrapper.style.display = 'none';
      streetViewWrapper.style.display = 'none';
    }

    // Toggle panels
    inputPanel.style.display = 'none';
    reportPanel.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  backToFormBtn.addEventListener('click', function () {
    reportPanel.style.display = 'none';
    inputPanel.style.display = 'block';
    window.scrollTo({ top: 0, behavior: 'smooth' });
  });

  printBtn.addEventListener('click', function () {
    window.print();
  });
</script>
</body>
</html>
